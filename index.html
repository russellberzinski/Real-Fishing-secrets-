<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BestFishingSecrets ‚Äî Feed</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0f1a33; --text:#e8edf7; --muted:#b7c0d6; --line:#223152;
      --accent:#60a5fa;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:var(--text)}

    /* ====== NEW: HERO COLLAGE HEADER ====== */
    .hero-collage{
      position:relative;
      width:100%;
      height:260px;
      overflow:hidden;
      border-bottom:1px solid var(--line);
      background:var(--card);
    }
    .collage-grid{
      height:100%;
      display:grid;
      grid-template-columns:repeat(8,1fr);
    }
    .collage-grid img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter:brightness(1.0) saturate(1.05);
      transform:scale(1.02);
    }
    .hero-overlay{
      position:absolute;
      inset:0;
      background:
        radial-gradient(ellipse at center, rgba(11,18,32,.35) 0%, rgba(11,18,32,.78) 70%, rgba(11,18,32,.92) 100%);
      pointer-events:none;
    }
    .hero-text{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      text-align:center;
      padding:0 14px;
      width:min(980px, 100%);
    }
    .hero-text h1{
      margin:0;
      font-size:34px;
      letter-spacing:.2px;
      font-weight:900;
      text-shadow:0 10px 30px rgba(0,0,0,.55);
    }
    .hero-text p{
      margin:8px 0 0;
      color:#c7d2fe;
      font-size:14px;
      text-shadow:0 8px 22px rgba(0,0,0,.55);
    }
    .hero-badges{
      margin-top:14px;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .hero-badge{
      border:1px solid rgba(255,255,255,.18);
      background:rgba(15,26,51,.55);
      padding:7px 10px;
      border-radius:999px;
      font-size:12px;
      color:rgba(232,237,247,.9);
      backdrop-filter: blur(6px);
    }

    /* Keep your sticky header below the collage */
    header{padding:18px 16px;border-bottom:1px solid var(--line);background:var(--card);position:sticky;top:0;z-index:5}
    h1{margin:0;font-size:18px}

    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .status{padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:var(--card);margin-bottom:12px;color:var(--muted);white-space:pre-wrap}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    button,input,select,textarea{font:inherit}
    button{
      border:1px solid var(--line);background:var(--card);color:var(--text);
      padding:10px 12px;border-radius:12px;cursor:pointer
    }
    button:hover{filter:brightness(1.1)}
    button:disabled{opacity:.55;cursor:not-allowed}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
    .card{border:1px solid var(--line);border-radius:16px;background:var(--card);padding:14px}
    .title{font-weight:800;margin:0 0 6px;font-size:16px}
    .meta{color:var(--muted);font-size:13px;margin:0 0 10px}
    .price{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#0b1220;font-weight:800}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .form{
      border:1px solid var(--line);
      border-radius:16px;
      background:var(--card);
      padding:14px;
      margin-bottom:14px;
    }
    .form h2{margin:0 0 10px;font-size:15px}
    .fields{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
    }
    .fields .full{grid-column:1 / -1}
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    input,select,textarea{
      width:100%;
      border:1px solid var(--line);
      background:#0b1220;
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      outline:none;
    }
    textarea{min-height:90px;resize:vertical}
    .hint{font-size:12px;color:var(--muted);margin-top:8px}
    .ok{color:#bbf7d0}
    .post-img{
      width:100%;
      border-radius:14px;
      border:1px solid var(--line);
      display:block;
      margin:0 0 10px 0;
      background:#0b1220;
    }
    .img-note{font-size:12px;color:var(--muted);margin-top:6px}
    .pill{
      border:1px solid var(--line);
      background:#0b1220;
      padding:8px 10px;
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
    }

    /* ====== NEW: Post instructions box ====== */
    .info-box{
      background: rgba(96,165,250,0.08);
      border: 1px solid rgba(96,165,250,0.35);
      border-radius: 14px;
      padding: 14px 16px;
      margin: 10px 0 14px;
    }
    .info-box h3{
      margin: 0 0 6px;
      font-size: 14px;
      color: var(--text);
      font-weight: 900;
      letter-spacing: .2px;
    }
    .info-box ul{
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
      font-size: 13px;
    }
    .info-box li{
      margin-bottom: 6px;
      line-height: 1.35;
    }
    .info-box li:last-child{margin-bottom:0}

    @media (max-width:900px){
      .hero-collage{height:220px}
      .collage-grid{grid-template-columns:repeat(4,1fr)}
      .hero-text h1{font-size:30px}
    }
    @media (max-width:720px){
      .fields{grid-template-columns:1fr}
      .hero-collage{height:190px}
      .hero-text h1{font-size:26px}
      .hero-text p{font-size:13px}
    }
  </style>
</head>
<body>

  <!-- ====== NEW: Collage banner (put your 8 images in /images/) ====== -->
  <section class="hero-collage" aria-label="Fishing photo collage">
    <div class="collage-grid" aria-hidden="true">
  <img src="FB_IMG_1770908475493.jpg" alt="">
  <img src="FB_IMG_1770908500189.jpg" alt="">
  <img src="FB_IMG_1770908712570.jpg" alt="">
  <img src="FB_IMG_1770908903224.jpg" alt="">
  <img src="FB_IMG_1770909246382.jpg" alt="">
  <img src="IMG_20250412_132452552_BURST000_COVER~2.jpg" alt="">
  <img src="IMG_20250607_174822729_HDR.jpg" alt="">
  <img src="IMG_20250607_184941296_HDR.jpg" alt="">
    </div>
    <div class="hero-overlay"></div>
    <div class="hero-text">
      <h1>BestFishingSecrets</h1>
      <p>See the catch. Unlock the details.</p>
      <div class="hero-badges">
        <span class="hero-badge">‚úÖ Browse free</span>
        <span class="hero-badge">üîí Sign-in to post</span>
        <span class="hero-badge">üß† Secrets stored privately</span>
      </div>
    </div>
  </section>

  <header><h1>BestFishingSecrets ‚Äî Live Feed</h1></header>

  <div class="wrap">
    <div id="status" class="status">Loading‚Ä¶</div>

    <div class="row" style="margin-top:8px">
      <span class="pill">‚úÖ Anyone can browse posts</span>
      <span class="pill">üîí Sign-in required to post</span>
      <span class="pill">üß† Secret location stored separately</span>
    </div>

    <div class="form">
      <h2>Browse</h2>
      <div class="fields">
        <div class="full">
          <label for="filterState">Filter by state (optional)</label>
          <select id="filterState">
            <option value="">All states</option>
            <option>Alabama</option><option>Alaska</option><option>Arizona</option><option>Arkansas</option>
            <option>California</option><option>Colorado</option><option>Connecticut</option><option>Delaware</option>
            <option>Florida</option><option>Georgia</option><option>Hawaii</option><option>Idaho</option>
            <option>Illinois</option><option>Indiana</option><option>Iowa</option><option>Kansas</option>
            <option>Kentucky</option><option>Louisiana</option><option>Maine</option><option>Maryland</option>
            <option>Massachusetts</option><option>Michigan</option><option>Minnesota</option><option>Mississippi</option>
            <option>Missouri</option><option>Montana</option><option>Nebraska</option><option>Nevada</option>
            <option>New Hampshire</option><option>New Jersey</option><option>New Mexico</option><option>New York</option>
            <option>North Carolina</option><option>North Dakota</option><option>Ohio</option><option>Oklahoma</option>
            <option>Oregon</option><option>Pennsylvania</option><option>Rhode Island</option><option>South Carolina</option>
            <option>South Dakota</option><option>Tennessee</option><option>Texas</option><option>Utah</option>
            <option>Vermont</option><option>Virginia</option><option>Washington</option><option>West Virginia</option>
            <option>Wisconsin</option><option>Wyoming</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="reloadBtn" type="button">Reload posts</button>
      </div>
      <div class="hint">Tip: choose a state to filter, then tap ‚ÄúReload posts‚Äù.</div>
    </div>

    <div class="form">
      <h2>Post a Catch</h2>

      <!-- ====== NEW: Instructions for sellers + buyers ====== -->
      <div class="info-box">
        <h3>How posting works (what buyers get)</h3>
        <ul>
          <li><strong>Preview link (Free):</strong> A teaser photo or short clip anyone can view (no spot giveaway).</li>
          <li><strong>Full link (Paid):</strong> The real content buyers are paying for ‚Äî full video, exact location details, access notes, etc.</li>
          <li><strong>Tip:</strong> If you upload a photo but leave Preview/Full link blank, we‚Äôll use the uploaded photo as the link automatically.</li>
          <li><strong>Secret location:</strong> Saved privately (not shown on the public feed). Only share what you‚Äôre comfortable with.</li>
        </ul>
      </div>

      <div class="fields">
        <div>
          <label for="title">Title</label>
          <input id="title" placeholder="e.g., 5lb bass at dawn" />
        </div>

        <div>
          <label for="state">State</label>
          <select id="state">
            <option value="">Select a state‚Ä¶</option>
            <option>Alabama</option><option>Alaska</option><option>Arizona</option><option>Arkansas</option>
            <option>California</option><option>Colorado</option><option>Connecticut</option><option>Delaware</option>
            <option>Florida</option><option>Georgia</option><option>Hawaii</option><option>Idaho</option>
            <option>Illinois</option><option>Indiana</option><option>Iowa</option><option>Kansas</option>
            <option>Kentucky</option><option>Louisiana</option><option>Maine</option><option>Maryland</option>
            <option>Massachusetts</option><option>Michigan</option><option>Minnesota</option><option>Mississippi</option>
            <option>Missouri</option><option>Montana</option><option>Nebraska</option><option>Nevada</option>
            <option>New Hampshire</option><option>New Jersey</option><option>New Mexico</option><option>New York</option>
            <option>North Carolina</option><option>North Dakota</option><option>Ohio</option><option>Oklahoma</option>
            <option>Oregon</option><option>Pennsylvania</option><option>Rhode Island</option><option>South Carolina</option>
            <option>South Dakota</option><option>Tennessee</option><option>Texas</option><option>Utah</option>
            <option>Vermont</option><option>Virginia</option><option>Washington</option><option>West Virginia</option>
            <option>Wisconsin</option><option>Wyoming</option>
          </select>
        </div>

        <div>
          <label for="price">Price (USD)</label>
          <input id="price" type="number" step="0.01" min="0" placeholder="9.99" />
        </div>

        <div>
          <label for="previewUrl">Preview link (optional)</label>
          <input id="previewUrl" placeholder="https://..." />
        </div>

        <div class="full">
          <label for="fullUrl">Full link (optional)</label>
          <input id="fullUrl" placeholder="https://..." />
        </div>

        <div class="full">
          <label for="photo">Photo (uploaded to Cloudinary)</label>
          <input id="photo" type="file" accept="image/*" />
          <div class="img-note">Optional, but recommended. Large files may take longer on mobile.</div>
        </div>

        <div class="full">
          <label for="secretLocation">Secret location (stored privately)</label>
          <textarea id="secretLocation" placeholder="Example: Lake name, GPS pin, access details‚Ä¶"></textarea>
          <div class="hint">This is stored in a private collection and not readable from the public feed.</div>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="postBtn" disabled>Sign in to post</button>
      </div>
      <div id="postHint" class="hint">You can browse without signing in. Sign in only if you want to post.</div>
    </div>

    <div id="grid" class="grid"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      setDoc,
      doc,
      serverTimestamp,
      query,
      orderBy,
      where
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      signInWithRedirect,
      getRedirectResult,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    // ====== DOM ======
    const statusEl = document.getElementById("status");
    const gridEl = document.getElementById("grid");

    const filterStateEl = document.getElementById("filterState");

    const titleEl = document.getElementById("title");
    const stateEl = document.getElementById("state");
    const priceEl = document.getElementById("price");
    const previewUrlEl = document.getElementById("previewUrl");
    const fullUrlEl = document.getElementById("fullUrl");
    const secretLocationEl = document.getElementById("secretLocation");
    const photoEl = document.getElementById("photo");

    const postBtn = document.getElementById("postBtn");
    const reloadBtn = document.getElementById("reloadBtn");
    const postHintEl = document.getElementById("postHint");

    // ====== Always show real errors on-page ======
    window.addEventListener("unhandledrejection", (e) => {
      statusEl.textContent = "‚ùå Unhandled promise:\n" + (e.reason?.message || e.reason || e);
    });
    window.addEventListener("error", (e) => {
      statusEl.textContent = "‚ùå JS error:\n" + (e.message || e);
    });

    // ====== Cloudinary (unsigned upload) ======
    const CLOUDINARY_CLOUD_NAME = "dhuakqubc";
    const CLOUDINARY_UPLOAD_PRESET = "emiktt1b";
    const CLOUDINARY_UPLOAD_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`;

    // ====== Firebase config ======
    const firebaseConfig = {
      apiKey: "AIzaSyCndtMlIb_Y_YCP1RO-ctfizRU6q1MGeHY",
      authDomain: "bestfishingsecrets-932cf.firebaseapp.com",
      projectId: "bestfishingsecrets-932cf",
      storageBucket: "bestfishingsecrets-932cf.firebasestorage.app",
      messagingSenderId: "387299114354",
      appId: "1:387299114354:web:cbadda074f9dd7083ef1eb",
      measurementId: "G-Z8L28MXNEG"
    };

    // ====== Init ======
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // ====== Auth UI ======
    const authRow = document.createElement("div");
    authRow.className = "row";
    authRow.innerHTML = `
      <button id="loginBtn" type="button">Sign in with Google</button>
      <button id="logoutBtn" type="button" style="display:none">Sign out</button>
      <span id="userInfo" class="meta"></span>
    `;
    statusEl.insertAdjacentElement("afterend", authRow);

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const userInfo = document.getElementById("userInfo");

    let currentUser = null;

    onAuthStateChanged(auth, (user) => {
      currentUser = user;

      if (user) {
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        userInfo.textContent = `Signed in as ${user.displayName || user.email || "User"}`;
        postBtn.disabled = false;
        postBtn.textContent = "Post catch";
        postHintEl.textContent = "‚úÖ You‚Äôre signed in ‚Äî you can post now.";
        postHintEl.classList.add("ok");
      } else {
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        userInfo.textContent = "Not signed in";
        postBtn.disabled = true;
        postBtn.textContent = "Sign in to post";
        postHintEl.textContent = "You can browse without signing in. Sign in only if you want to post.";
        postHintEl.classList.remove("ok");
      }
    });

    // Handle redirect sign-in result (mobile fallback)
    try{
      await getRedirectResult(auth);
    }catch(err){
      statusEl.textContent = "‚ö†Ô∏è Redirect sign-in error:\n" + (err?.message || String(err));
    }

    loginBtn.addEventListener("click", async () => {
      statusEl.textContent = "Signing in‚Ä¶";
      try {
        await signInWithPopup(auth, provider);
        statusEl.textContent = "‚úÖ Signed in.";
      } catch (e) {
        const msg = (e?.message || "").toLowerCase();
        const code = (e?.code || "").toLowerCase();
        const looksLikePopupBlocked =
          code.includes("popup") || msg.includes("popup") || msg.includes("blocked") || msg.includes("closed");

        if (looksLikePopupBlocked) {
          statusEl.textContent = "Popup blocked. Switching to redirect sign-in‚Ä¶";
          await signInWithRedirect(auth, provider);
          return;
        }

        statusEl.textContent = "‚ùå Sign-in failed:\n" + (e?.message || String(e));
      }
    });

    logoutBtn.addEventListener("click", async () => {
      try {
        await signOut(auth);
        statusEl.textContent = "Signed out.";
      } catch (e) {
        statusEl.textContent = "‚ùå Sign-out failed:\n" + (e?.message || String(e));
      }
    });

    // ====== Helpers ======
    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function isValidUrl(s){
      if (!s) return true;
      try { new URL(s); return true; } catch { return false; }
    }

    function cardHTML(p){
      const title = p.title ?? "Untitled catch";
      const state = p.state ?? "Unknown";
      const priceRaw = p.price;
      const price = (typeof priceRaw === "number") ? priceRaw.toFixed(2) : (priceRaw ?? "‚Äî");

      // Standardized fields (supports older docs too)
      const imageUrl = p.imageUrl ?? p.previewUrl ?? "";
      const previewUrl = p.previewUrl ?? "";
      const fullUrl = p.fullUrl ?? "";

      return `
        <div class="card">
          ${imageUrl ? `<img class="post-img" src="${escapeHtml(imageUrl)}" alt="Catch photo" loading="lazy" />` : ""}
          <p class="title">${escapeHtml(title)}</p>
          <p class="meta">State: <b>${escapeHtml(state)}</b></p>
          <p class="meta"><span class="price">$${escapeHtml(price)}</span></p>
          ${previewUrl ? `<p class="meta"><a href="${escapeHtml(previewUrl)}" target="_blank" rel="noopener">Preview link</a></p>` : ""}
          ${fullUrl ? `<p class="meta"><a href="${escapeHtml(fullUrl)}" target="_blank" rel="noopener">Full link</a></p>` : ""}
        </div>
      `;
    }

    async function uploadToCloudinary(file){
      const maxMB = 12;
      const sizeMB = file.size / (1024*1024);
      if (sizeMB > maxMB) throw new Error(`Image too large (${sizeMB.toFixed(1)}MB). Choose under ${maxMB}MB.`);
      if (!file.type.startsWith("image/")) throw new Error("Selected file is not an image.");

      const fd = new FormData();
      fd.append("file", file);
      fd.append("upload_preset", CLOUDINARY_UPLOAD_PRESET);

      const res = await fetch(CLOUDINARY_UPLOAD_URL, { method: "POST", body: fd });
      if (!res.ok) {
        const text = await res.text().catch(() => "");
        throw new Error(`Cloudinary upload failed (${res.status}). ${text}`);
      }
      return await res.json();
    }

    // ====== Load posts (public) ======
    async function loadPosts(){
      gridEl.innerHTML = "";
      statusEl.textContent = "Loading posts‚Ä¶";

      const chosenState = filterStateEl.value.trim();

      try{
        let snap;
        try{
          const base = collection(db, "posts");

          const q = chosenState
            ? query(base, where("state", "==", chosenState), orderBy("createdAt", "desc"))
            : query(base, orderBy("createdAt", "desc"));

          snap = await getDocs(q);
        }catch(e){
          snap = await getDocs(collection(db, "posts"));
        }

        if (!snap || snap.empty){
          statusEl.textContent = chosenState
            ? `No posts found for ${chosenState} yet.`
            : "No posts yet. Sign in if you want to post the first one.";
          return;
        }

        let posts = [];
        snap.forEach(d => posts.push(d.data()));

        if (chosenState) {
          posts = posts.filter(p => (p.state || "").trim() === chosenState);
        }

        if (!posts.length) {
          statusEl.textContent = `No posts found for ${chosenState} yet.`;
          return;
        }

        let html = "";
        for (const p of posts) html += cardHTML(p);
        gridEl.innerHTML = html;

        statusEl.textContent = chosenState
          ? `Loaded ${posts.length} post(s) for ${chosenState}.`
          : `Loaded ${posts.length} post(s).`;
      }catch(err){
        statusEl.textContent =
          "‚ùå Error loading posts.\n\nMost common causes:\n- Firestore Rules blocking reads\n- Firestore not created\n- Network/adblock\n\nDetails:\n" + (err?.message || String(err));
      }
    }

    // ====== Post catch (public doc + private secret doc) ======
    async function postCatch(){
      if (!currentUser) {
        statusEl.textContent = "‚ùå Please sign in first to post.";
        return;
      }

      const title = titleEl.value.trim();
      const state = stateEl.value.trim();
      const priceStr = priceEl.value.trim();

      // Optional links
      const previewLinkTyped = previewUrlEl.value.trim();
      const fullLinkTyped = fullUrlEl.value.trim();

      // Secret stored privately (NOT in /posts)
      const secretLocation = secretLocationEl.value.trim();

      if (!title) { statusEl.textContent = "‚ùå Please enter a title."; return; }
      if (!state) { statusEl.textContent = "‚ùå Please select a state."; return; }
      if (priceStr === "" || Number.isNaN(Number(priceStr))) { statusEl.textContent = "‚ùå Please enter a valid price."; return; }
      if (!isValidUrl(previewLinkTyped) || !isValidUrl(fullLinkTyped)) { statusEl.textContent = "‚ùå One of your links is not a valid URL."; return; }

      postBtn.disabled = true;

      let imageUrl = null;
      let imagePublicId = null;

      try{
        const file = photoEl.files && photoEl.files[0] ? photoEl.files[0] : null;
        if (file) {
          statusEl.textContent = "Uploading photo‚Ä¶";
          const uploaded = await uploadToCloudinary(file);
          imageUrl = uploaded.secure_url || uploaded.url || null;
          imagePublicId = uploaded.public_id || null;
          if (!imageUrl) throw new Error("Upload succeeded but no image URL was returned.");
        }

        statusEl.textContent = "Posting‚Ä¶";

        // Standardize previewUrl/fullUrl:
        // - if user typed links, use them
        // - else if uploaded image exists, set both to imageUrl
        // - else null
        const previewUrl = previewLinkTyped || imageUrl || null;
        const fullUrl = fullLinkTyped || imageUrl || null;

        // 1) Create public post doc
        const postRef = await addDoc(collection(db, "posts"), {
          title,
          state,
          price: Number(priceStr),

          // media
          imageUrl: imageUrl,
          imagePublicId: imagePublicId,
          previewUrl: previewUrl,
          fullUrl: fullUrl,

          // secret is NOT stored here
          hasSecret: !!secretLocation,

          userId: currentUser.uid,
          userName: currentUser.displayName || null,
          userEmail: currentUser.email || null,
          createdAt: serverTimestamp()
        });

        // 2) Store secret in a private collection with SAME doc id
        if (secretLocation) {
          await setDoc(doc(db, "postSecrets", postRef.id), {
            postId: postRef.id,
            ownerId: currentUser.uid,
            secretLocation: secretLocation,
            createdAt: serverTimestamp()
          });
        }

        // Clear form
        titleEl.value = "";
        stateEl.value = "";
        priceEl.value = "";
        previewUrlEl.value = "";
        fullUrlEl.value = "";
        secretLocationEl.value = "";
        photoEl.value = "";

        statusEl.textContent = "‚úÖ Posted!";
        await loadPosts();
      }catch(err){
        statusEl.textContent = "‚ùå Post failed.\n\nDetails:\n" + (err?.message || String(err));
      }finally{
        postBtn.disabled = !currentUser;
      }
    }

    postBtn.addEventListener("click", postCatch);
    reloadBtn.addEventListener("click", loadPosts);
    filterStateEl.addEventListener("change", loadPosts);

    // Start
    await loadPosts();
  </script>
</body>
</html>
